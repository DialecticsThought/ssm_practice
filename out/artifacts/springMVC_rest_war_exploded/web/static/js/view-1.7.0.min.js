/**
 * View.js v1.7.0
 * author: Billy, wmjhappy_ok@126.com
 * license: MIT
 * 
 * -- 2020-06-07 12:43
 */
(function(t){var n,e,i,r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t in r?console.error("Plugin name: 'View' has already been used"):(n={},i={has:function(e){return e in n},set:function(e,t){if(e in n)throw new Error("Internal error: Key: '"+e+"' has already been used");n[e]=t},get:function(e){return n[e]},expose:e=function(e){r[t]=e}},e(function(e){if("function"==typeof e)try{e(i)}catch(e){console.error(e)}}))})("View"),View(function(e){function i(){if(0!==arguments.length){var i=arguments,e=" "+String(arguments[0]),r=1;return(e=(e=e.replace(/([^\\])\{\}/g,function(e,t){var n=i.length-1<r?"{}":String(s(i[r]));return r++,t+n})).replace(/\\\{\}/g,"{}")).substring(1)}}function r(e){return(t=new Date).getFullYear(),n=(n="0"+String(t.getMonth()+1)).substring(n.length-2),i=(i="0"+String(t.getDate())).substring(i.length-2),r=(r="0"+String(t.getHours())).substring(r.length-2),a=(a="0"+String(t.getMinutes())).substring(a.length-2),o="0"+String(t.getSeconds()),n+i+" "+r+":"+a+":"+(o=o.substring(o.length-2))+" ["+e+"]: ";var t,n,i,r,a,o}function n(t){var n=!0;this.isEnabled=function(){return o&&n},this.setIsEnabled=function(e){return n=e,this},this.getName=function(){return t},this.debug=function(){var e;this.isEnabled()&&(e=i.apply(null,arguments),console.debug(r(t)+e))},this.info=function(){var e;this.isEnabled()&&(e=i.apply(null,arguments),console.info(r(t)+e))},this.warn=function(){var e;this.isEnabled()&&(e=i.apply(null,arguments),console.warn(r(t)+e))},this.error=function(){var e;this.isEnabled()&&(e=i.apply(null,arguments),console.error(r(t)+e))},this.log=function(){var e;this.isEnabled()&&(e=i.apply(null,arguments),console.log(r(t)+e))}}var a={},o=!0,s=function(e){if(null==e)return null;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e)return e;if("function"==typeof e)return"function "+e.name+"(){...}";if("object"!=typeof e||Array.isArray(e))return e instanceof Array?"["+e.map(function(e){return s(e)}).join(", ")+"]":e;if("[object Object]"!==String(e))return String(e);var t=JSON.stringify(e);if("{}"!==t)return t;try{var n={};for(var i in e)n[i]=s(e[i]);return JSON.stringify(n)}catch(e){return t}};n.ofName=function(e){if(e in a)return a[e];var t=new n(e);return a[e]=t},n.isGloballyEnabled=function(){return o},n.setIsGloballyEnabled=function(e){o=!!e},n.globalLogger=n.ofName("View"),e.set("Logger",n)}),View(function(e){function l(e,t){this.type=e,this.timestamp=(new Date).getTime(),this.data=t,Object.freeze&&Object.freeze(this)}e.set("eventDrive",function(e,a){function o(e){s[e]=s[e]||[]}var s={};e.on=function(e,t){String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){o(e),-1===s[e].indexOf(t)&&s[e].push(t)})},e.off=function(e,n){String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){o(e);var t=s[e].indexOf(n);-1!==t&&s[e].splice(t,1)})},e.fire=function(e,t,r){arguments.length<3&&(r=!0),String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(n){function e(){o(n);for(var e=0;e<s[n].length;e++){var t=s[n][e];if("function"==typeof t)try{t.call(a,i)}catch(e){console.error(e,e.stack)}}}var i=new l(n,t);r?setTimeout(e,0):e()})}})}),View(function(toolbox){var globalLogger=toolbox.get("Logger").globalLogger,setDftValue=function(e,t,n){for(var i in arguments.length<3&&(n=!1),e=e||{},t=t||{})i in e&&!(i in e&&null==e[i]&&n)||(e[i]=t[i]);return e},defineReadOnlyProperty=function(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!1,writable:!1,enumerable:!0})},try2Apply=function(t,e,n){if(null!=t&&"function"==typeof t)try{t.apply(e,n)}catch(e){var i=e instanceof Error||null!=e&&"object"==typeof e&&"stack"in e,r="Error occured while executing function: {}. {}"+(i?" stack:\n{}":"");globalLogger.error(r,t.name,e,i?e.stack:null)}},try2Call=function(func,ctx,args){if(null!=func&&"function"==typeof func)try{var len=arguments.length;if(1===len)return func();if(2===len)return func.call(ctx);if(3===len)return func.call(ctx,args);if(4===len)return func.call(ctx,args,arguments[3]);if(5===len)return func.call(ctx,args,arguments[3],arguments[4]);if(6===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5]);if(7===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5],arguments[6]);for(var tmp="",index=2,i=index,rst;i<arguments.length;i++)tmp+=",arguments["+i+"]";return eval("rst = func.call(ctx"+tmp+")"),rst}catch(e){return console.error("Error occurred while executing function: "+func.name,e.stack||e),void console.error(func)}},isEmptyString=function(e,t){return arguments.length<2&&(t=!1),null==e||(e=String(e),t&&(e=e.trim()),0===e.length)},isNullOrUndefined=function(e){return null==e},ifStringEquals=function(e,t,n,i){return arguments.length<4&&(i=!0),arguments.length<3&&(n=!0),isNullOrUndefined(e)?!!isNullOrUndefined(t):!isNullOrUndefined(t)&&(i&&(e=String(e).trim(),t=String(t).trim()),n||(e=e.toLowerCase(),t=t.toLowerCase()),e===t)},ifStringEqualsIgnoreCase=function(e,t,n){return arguments.length<3&&(n=!0),ifStringEquals(e,t,!1,n)},randomString=(_a="0123456789abcdefghijklmnopqrstuvwxyz",function(e){arguments.length<1&&(e="");for(var t=10,n="";0<t--;){var i=Math.floor(Math.random()*_a.length);n+=_a.charAt(i)}return e+n}),_a,xEncodeURIComponent=function(e){return encodeURIComponent(String(e)).replace(/\+/gm,"%2B")},getUniqueString=(fb=0,function(){var e=Date.now().toString(36),t="00"+(fb++).toString(36);return(e+(t=t.substring(t.length-2))).toUpperCase()}),fb,getComputedStyle=function(e){return window.getComputedStyle?window.getComputedStyle(e):e.currentStyle},env=(kb=navigator.userAgent,lb={},(lb.refresh=mb)(),lb),kb,lb;function mb(){return kb=navigator.userAgent,lb.isUC=/(?:UCWEB|UCBrowser)/.test(kb),lb.isSafari=/(?:Safari)/.test(kb),lb.isOpera=/(?:Opera Mini)/.test(kb),lb.isTencent=/(?:MQQBrowser|QQ|MicroMessenger)/.test(kb),lb.isTencentMiniProgram=lb.isTencent&&(/(?:miniprogram)/i.test(kb)||"miniprogram"===window.__wxjs_environment),lb.isIOS=/(?:Mac OS)/.test(kb),lb.isAndroid=/(?:Android)/.test(kb),lb.isWindowsPhone=/(?:Windows Phone)/.test(kb),lb.isIPad=lb.isIOS&&/(?:iPad)/.test(kb),lb.isIPhone=lb.isIOS&&/(?:iPhone)/.test(kb),lb.isTablet=/(?:Tablet|PlayBook)/.test(kb)||lb.isIPad,lb.isMobile=/(?:Mobile)/.test(kb)&&!lb.isIPad||lb.isWindowsPhone,lb.isPc=!lb.isMobile&&!lb.isTablet,lb.isHistoryPushPopSupported="pushState"in history&&"function"==typeof history.pushState,lb}var parseParams=function(e){if(isEmptyString(e,!0))return null;var n=null,t=e.split(/\s*&\s*/);return 0!==t.length&&(n={},t.forEach(function(e){var t=e.split(/\s*=\s*/);n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})),n},blurInputs=function(){for(var e=document.querySelectorAll("input, select, textarea, *[contentEditable]"),t=0;t<e.length;t++)e[t].blur()},hasClass=function(e,t){return!isEmptyString(t,!0)&&(e.classList&&e.classList.contains?e.classList.contains(t):new RegExp("\\b"+t+"\\b","gim").test(e.className))},addClass=function(e,t){isEmptyString(t,!0)||hasClass(e,t)||(e.classList&&e.classList.add?e.classList.add(t):e.className=(e.className.trim()+" "+t).trim())},removeClass=function(e,t){if(!isEmptyString(t,!0)&&hasClass(e,t))if(e.classList&&e.classList.remove)e.classList.remove(t);else{t=String(t).toLowerCase();for(var n=e.className.split(/\s+/),i="",r=0;r<n.length;r++){var a=n[r];isEmptyString(a,!0)||a.toLowerCase()!==t&&(i+=" "+a)}0<i.length&&(i=i.substring(1)),e.className=i.trim()}},toggleClass=function(e,t){return hasClass(e,t)?(removeClass(e,t),!1):(addClass(e,t),!0)},startsWith=function(e,t){if(null==t)return!1;var n=(t=String(t)).length;return!(this.length<n)&&e.substring(0,n)===t},isPromiseSupported=function(){return"undefined"!=typeof Promise&&null!=Promise&&"function"==typeof Promise.resolve},applyInternally=function(e,t,n){return e.apply(t,n)},callInternally=function(func,ctx,args){var len=arguments.length;if(1===len)return func();if(2===len)return func.call(ctx);if(3===len)return func.call(ctx,args);if(4===len)return func.call(ctx,args,arguments[3]);if(5===len)return func.call(ctx,args,arguments[3],arguments[4]);if(6===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5]);if(7===len)return func.call(ctx,args,arguments[3],arguments[4],arguments[5],arguments[6]);for(var tmp="",index=2,i=index,rst;i<arguments.length;i++)tmp+=",arguments["+i+"]";return eval("rst = func.call(ctx"+tmp+")"),rst},markAsInternalCallableOnly=function(t){return function(){var e=arguments.callee.caller;if(e!==callInternally&&e!==applyInternally)throw new Error("Illegal function call, only internal valid caller is permitted");return t.apply(this,arguments)}};toolbox.set("util",{setDftValue:setDftValue,defineReadOnlyProperty:defineReadOnlyProperty,try2Apply:try2Apply,try2Call:try2Call,isEmptyString:isEmptyString,isNullOrUndefined:isNullOrUndefined,startsWith:startsWith,ifStringEquals:ifStringEquals,ifStringEqualsIgnoreCase:ifStringEqualsIgnoreCase,randomString:randomString,xEncodeURIComponent:xEncodeURIComponent,getUniqueString:getUniqueString,getComputedStyle:getComputedStyle,parseParams:parseParams,blurInputs:blurInputs,isPromiseSupported:isPromiseSupported,hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,callInternally:callInternally,applyInternally:applyInternally,markAsInternalCallableOnly:markAsInternalCallableOnly,env:env})}),View(function(e){function t(){var e=u.clientWidth,t=u.clientHeight,n=window.innerWidth||e,i=window.innerHeight||t;s.env.refresh();var r=s.env.isPc,a=!1,o=[];r!==d&&(a=!0,o.push("env")),.5<Math.abs(n-c)?(a=!0,o.push("width"),o.push("width"+(g<e?"+":"-"))):.5<Math.abs(i-f)&&(a=!0,o.push("height"),o.push("height"+(f<i?"+":"-"))),g=e,c=n,f=i,d=r,a&&(l.debug("Resolution changes. Changed aspects: {}",o),function(e){for(var t=0;t<h.length;t++){var n=h[t],i=n.listeningChangeAspects;if(Array.isArray(i)){for(var r=!1,a=0;a<i.length;a++)if(-1!==e.indexOf(i[a])){r=!0;break}r&&s.try2Call(n,null,e)}else s.try2Call(n,null,e)}}(o))}var s=e.get("util"),l=e.get("Logger").globalLogger,u=document.documentElement,c=0,f=0,g=0,d=null,h=[];t(),setInterval(t,20);var n={addChangeListener:function(e,t){1===arguments.length&&"function"==typeof e&&(t=e,e=null),-1===h.indexOf(t)&&(Array.isArray(e)&&(e=e.map(function(e){return String(e).trim().toLowerCase()})),t.listeningChangeAspects=e,h.push(t))}};e.set("resolution",n)}),View(function(e){function h(){return a.querySelector("[data-view-container]")||document.body||a}function w(){var e=h(),t=E.getComputedStyle(e),n=Number(t.paddingLeft.replace(/px/,"")),i=Number(t.paddingRight.replace(/px/,""));return isNaN(n)&&(n=0),isNaN(i)&&(i=0),e.clientWidth-n-i}function p(){var e=h(),t=E.getComputedStyle(e),n=Number(t.paddingTop.replace(/px/,"")),i=Number(t.paddingBottom.replace(/px/,""));return isNaN(n)&&(n=0),isNaN(i)&&(i=0),e.clientHeight-n-i}function m(){return window.innerWidth||a.clientWidth}function v(){return window.innerHeight||a.clientHeight}function t(){return w()<=p()}function y(){return m()<=v()}function b(){return!y()}var S,V,n=e.get("Logger").globalLogger,E=e.get("util"),i=e.get("resolution"),A=320/568,I=[],r=!1,C={},a=document.documentElement,P=function(e,t){var n=this.style;n.width=e+"px",n.height=t+"px"},T=P,_=P,N=T,L=P,O=T,x=O,o=(S=w(),V=p(),function(e){var t,n,i,r,a,o,s,l;arguments.length<1&&(e=!0),E.env.isPc?(s=m(),l=v(),y()?E.try2Call(L,h(),s,l):x===O?(s=l*A,E.try2Call(P,h(),s,l)):E.try2Call(x,h(),s,l)):E.env.isTablet?(r=m(),a=v(),o=b()?N:_,E.try2Call(o,h(),r,a)):(t=m(),n=v(),i=b()?T:P,E.try2Call(i,h(),t,n));var u,c=w(),f=p(),g=m(),d=v();return(.1<=Math.abs(S-c)||.1<=Math.abs(V-f))&&(u=function(){for(var e=0;e<I.length;e++){var t=I[e];"function"==typeof t&&E.try2Call(t,null,c,f,g,d)}},e?setTimeout(u,0):u()),C});(0,E.setDftValue)(C,{getLayoutWidth:w,getLayoutHeight:p,getBrowserWidth:m,getBrowserHeight:v,isLayoutPortrait:t,isLayoutLandscape:function(){return!t()},isBrowserPortrait:y,isBrowserLandscape:b,getLayoutWidthHeightRatio:function(){return m()/v()},getBrowserWidthHeightRatio:function(){return m()/v()},getExpectedWidthHeightRatio:function(){return A},setExpectedWidthHeightRatio:function(e){return A=e,C},init:function(e){return r?n.warn("Layout was initialized already"):(r=!0,e=E.setDftValue(e,{autoReLayoutWhenResize:!0,layoutAsMobilePortrait:P,layoutAsMobileLandscape:T,layoutAsTabletLandscape:N,layoutAsTabletPortrait:_,layoutAsPcPortrait:L,layoutAsPcLandscape:x}),!!e.autoReLayoutWhenResize&&i.addChangeListener(function(e){-1!==e.indexOf("height-")||-1!==e.indexOf("height+")&&p()>=v()||o(!1)}),"function"==typeof e.layoutAsMobilePortrait&&(P=e.layoutAsMobilePortrait),"function"==typeof e.layoutAsMobileLandscape&&(T=e.layoutAsMobileLandscape),"function"==typeof e.layoutAsTabletPortrait&&(_=e.layoutAsTabletPortrait),"function"==typeof e.layoutAsTabletLandscape&&(N=e.layoutAsTabletLandscape),"function"==typeof e.layoutAsPcPortrait&&(L=e.layoutAsPcPortrait),"function"==typeof e.layoutAsPcLandscape&&(x=e.layoutAsPcLandscape)),C},doLayout:o,addLayoutChangeListener:function(e){if(-1===I.indexOf(e))return I.push(e),C},removeLayoutChangeListener:function(e){var t=I.indexOf(e);if(-1!==t)return I.splice(t,1),C}}),Object.freeze&&Object.freeze(C),e.set("layout",C)}),View(function(e){function u(e,t){return(e=e||{})[t]=e[t]||{},e[t]}var c=e.get("util"),f=(window,/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent)),g="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ";e.set("touch",{addTapListener:function(o,e,s){var l,t;f?((l=u(o,g+".tap")).callbacks=l.callbacks||[],-1===l.callbacks.indexOf(e)&&(l.callbacks.push(e),(s=c.setDftValue(s,{timespan:500,delta:{},useCapture:!1})).delta=c.setDftValue(s.delta,{x:10,y:15}),null==(t=u(o,g+".tap.meta")).touchstart&&(t.touchstart=function(e){var t=e.changedTouches?e.changedTouches[0]:e;l.startX=t.screenX,l.startY=t.screenY,l.startTimestamp=Date.now()},o.addEventListener("touchstart",t.touchstart)),null==t.touchend&&(t.touchend=function(e){var t=e.changedTouches?e.changedTouches[0]:e;l.stopX=t.screenX,l.stopY=t.screenY,l.stopTimestamp=Date.now();var n=l.stopTimestamp-l.startTimestamp,i=Math.abs(l.stopX-l.startX),r=Math.abs(l.stopY-l.startY);if(n<=s.timespan&&i<=s.delta.x&&r<=s.delta.y)for(var a=0;a<l.callbacks.length;a++)c.try2Call(l.callbacks[a],o,e)},o.addEventListener("touchend",t.touchend,s.useCapture)))):o.addEventListener?o.addEventListener("click",e):o.attachEvent("onclick",e)},removeTapListener:function(e,t,n){var i,r,a;f?!e.hasOwnProperty(g)||-1!==(r=(i=u(e,g+".tap")).callbacks.indexOf(t))&&(i.callbacks.splice(r,1),0===i.callbacks.length&&(a=u(e,g+".tap.meta"),e.removeEventListener("touchstart",a.touchstart),e.removeEventListener("touchend",a.touchend,n),delete e[g].tap)):e.removeEventListener?e.removeEventListener("click",t):e.detachEvent("onclick",t)}})}),View(function(e){e.get("util");e.set("ViewContext",function(){var n={};this.has=function(e){return e in n},this.set=function(e,t){return n[e]=t,this},this.get=function(e){return n[e]},this.remove=function(e){var t=n[e];return delete n[e],t},this.clear=function(){for(var e in n)delete n[e];return this},this.listKeys=function(){return Object.keys(n)},this.size=function(){var e=0;for(var t in n)e++;return e}})}),View(function(e){var s=e.get("Logger").globalLogger,l={};e.set("ViewConfiguration",function(n,i,r){var a,e=n,o=l;this.getName=function(){return e},this.getValue=function(e){return l!==o?o:arguments.length<1?void 0:e},this.setValue=function(e,t){return arguments.length<2&&(t=!1),!t&&l!==o||(o=e),this},this.getApplication=function(){return a},this.setApplication=function(e){return"function"!=typeof e?s.warn("Application action should be of type: 'Function'"):a=e,this},this.apply=function(){if("function"==typeof a){var t=l===o?void 0:o;try{a.call(this,t)}catch(e){s.error("Fail to apply configuration: {} = {} for view of id: '{}' namespace: '{}'\n{}",n,String(t),i,r,e),e instanceof Error?console.error(e,e.stack):console.error(e)}}return this},this.reflectToDom=function(){return null==i||""===i.trim()||(View.ifExists(i,r)?"function"==typeof this.getValue()||Array.isArray(this.getValue)?(s.warn("Invalid value to reflect to dom:"),console.warn(this.getValue())):View.ofId(i,r).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())):s.warn("No view of id '{}' in namespace: '{}' found to reflect config: {}={}",i,r,this.getName(),this.getValue())),this},Object.freeze(this)})}),View(function(e){var a=e.get("util"),o=e.get("ViewConfiguration");e.set("ViewConfigurationSet",function(n,i){var r={};this.has=function(e){return e in r},this.get=function(e){var t;return e in r?t=r[e]:(t=new o(e,n,i),r[e]=t),t},this.applyAll=function(){var n=Object.keys(r).map(function(e){return r[e]});return 0===n.length||setTimeout(function(){for(var e=0;e<n.length;e++){var t=n[e];a.try2Call(t.apply,t)}},0),this},this.listAll=function(){return Object.keys(r)}})}),View(function(e){function s(e,t,n){var i=u.isEmptyString(t,!0)||f===t?"":"@"+String(t),r=String(e)+i,a=(null==n?[]:Object.keys(n)).reduce(function(e,t){return e+"&"+u.xEncodeURIComponent(t)+"="+u.xEncodeURIComponent(n[t])},"");return 0<a.length&&(r+="!"+a.substring(1)),r}function l(e,t,n,i){arguments.length<3&&(i=null),arguments.length<2&&(n=u.getUniqueString()),n=n||u.getUniqueString(),u.defineReadOnlyProperty(this,"viewId",e),u.defineReadOnlyProperty(this,"viewNamespace",t),u.defineReadOnlyProperty(this,"sn",n),u.defineReadOnlyProperty(this,"options",i),u.defineReadOnlyProperty(this,"flag",r),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return{viewId:e,viewNamespace:t,sn:n,options:i,flag:r}}}var u=e.get("util"),c=e.get("Logger").globalLogger,f="default",t="ViewState_",r=u.randomString(t),g=[],d=-1;l.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("viewId")&&e.hasOwnProperty("sn")&&u.startsWith(e.flag,t))},l.pushViewState=function(e,t,n,i){arguments.length<4&&(i=null),arguments.length<3&&(n=u.getUniqueString()),(arguments.length<2||u.isEmptyString(t,!0))&&(t=f),n=n||u.getUniqueString();var r=new l(e,t,n,i).clone();c.log("↓ {}",JSON.stringify(r)),u.env.isHistoryPushPopSupported?history.pushState(r,"","#"+s(e,t,i)):location.hash=s(e,t,i),g.splice(d+1,g.length),g.push(r),d++,h(),View.currentState=r},l.replaceViewState=function(e,t,n,i){arguments.length<4&&(i=null),arguments.length<3&&(n=u.getUniqueString()),(arguments.length<2||u.isEmptyString(t,!0))&&(t=f),n=n||u.getUniqueString();var r,a,o=new l(e,t,n,i).clone();c.log("% {}",JSON.stringify(o)),u.env.isHistoryPushPopSupported?history.replaceState(o,"","#"+s(e,t,i)):location.hash=s(e,t,i),0===g.length?(g.push(o),d++):(r=g[d-1],a=g[d+1],null!=r&&r.sn===n?d--:null!=a&&a.sn===n?d++:g[d]=o,h()),View.currentState=o},l.getStackSize=function(){return g.length},l.ifCanGoBack=function(){return 0<d};var h=function(){c.debug("View state stack: {}, {}",g.map(function(e){return e.sn}),d)};e.set("ViewState",l)}),View(function(e){e.get("util");function l(){}function r(n,i){var t=l,r=!0,a=50;this.setLayoutAction=function(e){return"function"!=typeof e?c.error("Layout action should be of type: 'Function'"):t!==e&&(t=e),this},this.getLayoutAction=function(){return t},this.doLayout=function(){return"function"!=typeof t||((0<Math.abs(h-g)||0<Math.abs(w-d))&&(f.offsetWidth,f.offsetHeight),t(),g=h,d=w),this},this.setLayoutCushionTime=function(e){return null==e||isNaN(e=Number(e))||e<0?c.error("Invalid layout cushion time. Should be a digit greater than or equal to 0"):a=e,this},this.getLayoutCushionTime=function(){return a},this.setIfLayoutWhenLayoutChanges=function(e){return r=!!e,this};var o,s=this;u.addLayoutChangeListener(function(e,t){r&&View.ofId(n,i).isActive()&&(c.debug("Layout changes, doing layout for view of id: '{}' namespace: '{}'. Width: {}, height: {}",n,i,e,t),h=e,w=t,clearTimeout(o),0<a?o=setTimeout(function(){s.doLayout()},a):s.doLayout())})}var u=e.get("layout"),c=e.get("Logger").globalLogger,f=document.documentElement,a={},g=-1,d=-1,h=0,w=0;r.ofId=function(e,t){var n=e+"@"+t;if(n in a)return a[n];var i=new r(e,t);return a[n]=i},e.set("ViewLayout",r)}),View(function(e){function r(e,t){arguments.length<2&&(t=a.getUniqueString()),t=t||a.getUniqueString(),a.defineReadOnlyProperty(this,"serialNumber",e),a.defineReadOnlyProperty(this,"sn",t),a.defineReadOnlyProperty(this,"flag",n),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}}var a=e.get("util"),t="OperationState_",n=a.randomString(t),o=null,s={};r.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("serialNumber")&&e.hasOwnProperty("sn")&&a.startsWith(e.flag,t))},r.pushState=function(e,t){var n=new OperationState(e).clone();history.pushState(n,"",""),o=n,s[e]=t},window.addEventListener("popstate",function(e){var t,n;r.isConstructorOf(o)&&(t=e.state&&e.state.sn&&e.state.sn<o.sn,n=s[o.serialNumber],t&&null!=n&&(a.try2Call(n),delete s[o.serialNumber]));var i=e.state;o=r.isConstructorOf(i)?i:null}),e.set("OperationState",r)}),View(function(e){function n(r){var a=[],n={},o={},s=!1;this.getName=function(){return r},this.setSequence=function(e){return s?l.error("Sequence is prohibited to change while executing"):Array.isArray(e)&&(e=e.map(function(e){return null==e?"":String(e).trim().toLowerCase()}).reduce(function(e,t){return i.isEmptyString(t,!0)||-1!==e.indexOf(t)||e.push(t),e},[]),a=e),this},this.setProperty=function(e,t){return n[String[e]]=t,this},this.setProperties=function(e){if(null==e||"object"!=typeof e)return this;for(var t in e)this.setProperty(t,e[t]);return this},this.getProperty=function(e,t){return(e=String(e))in n?n[e]:1<arguments.length?t:null},this.setHandle=function(e,t){return s?l.error("Handle is prohibited to change while executing"):o[String(e).toLowerCase()]=t,this},this.exec=function(){var n,i;l.debug("Executing chained handle: {}",r),s=!0;var e=new Promise(function(e,t){n=e,i=t});if(e.then(function(){s=!1},function(){s=!1}),0===a.length)return n(),e;var t=function(r){r>=a.length?n():new Promise(function(e,n){var i=a[r],t=o[i];if(l.debug("Executing handle: {}",i),null!=t)try{t(e,function(e){var t="Handle of name: "+i+"rejects";1<arguments.length?l.error(t,e):l.error(t),n(e)})}catch(e){l.error("Error occurred while executing handle of name: "+i),console.error(e),n(e)}else e()}).then(function(){t(r+1)},i)};return t(0),e}}var i=e.get("util"),l=e.get("Logger").globalLogger,r={};n.ofName=function(e){var t=r[e];return null==t&&(t=r[e]=new n(e)),t},e.set("ChainedHandle",n)}),View(function(e){e.set("viewAttribute",{attr$view_auto_init:"data-view-auto-init",attr$viewId:"data-view-id",attr$view_name:"data-view-name",attr$view_group:"data-view-group",attr$view_namespace:"data-view-namespace",attr$view_title:"data-view-title",attr$view_fallback:"data-view-fallback",attr$view_fallback_namespace:"data-view-fallback-namespace",attr$view:"data-view",attr$view_default:"data-view-default",attr$view_directly_accessible:"data-view-directly-accessible",attr$view_whr:"data-view-whr",attr$view_state:"data-view-state",attr$view_os:"data-view-os",attr$active_view_id:"data-active-view-id",attr$active_view_namespace:"data-active-view-namespace",attr$view_container:"data-view-container",attr$view_rel:"data-view-rel",attr$view_rel_namespace:"data-view-rel-namespace",attr$view_rel_type:"data-view-rel-type",attr$view_rel_disabled:"data-view-rel-disabled"})}),View(function(e){e.get("Logger").globalLogger;var a=e.get("util"),t=":forward",n=":default-view",o=/^#([\w$\-]+)(?:@([^!]+))?(?:!+(.*))?/;e.set("viewRepresentation",{PSVIEW_BACK:":back",PSVIEW_FORWARD:t,PSVIEW_DEFAULT:n,isPseudoView:function(e){return":back"===e||t===e||n===e},parseViewInfoFromHash:function(e){if(""===e)return null;var t=e.match(o);if(null==t)return null;var n=t[1],i=t[2],r=a.parseParams(t[3]);return a.isEmptyString(i,!0)&&(i="default"),{viewId:n,viewNamespace:i,specifiedViewNamespace:t[2],options:r}}})}),View(function(e){function i(e,t,n){a[e+"@"+t]=n}var t=e.get("util"),r=(e.get("Logger").globalLogger,e.get("viewRepresentation")),n=t.randomString("_autosavedparams_"),a={};e.set("viewParameter",{keyForParamsAutoSavedToContext:n,hasParameters:function(e,t){return e+"@"+t in a},getParameters:function(e,t){return a[e+"@"+t]},setParameters:i,removeParameters:function(e,t){delete a[e+"@"+t]},setViewParameters:function(e,t,n){if(!View.ifExists(e,t)&&!r.isPseudoView(e))throw new Error("View of id: '"+e+"' within namespace: '"+t+"' does not exist");if(void 0===n&&(n=null),"object"!=typeof n)throw new Error("Parameters specified should be an object or null");return i(e,t,n),View},clearViewParameters:function(e,t){return delete a[e+"@"+t],View}})}),View(function(e){function l(e){e in r||(r[e]=[])}function u(e){if(!(e instanceof HTMLElement))return null;var t=e.getAttribute(V.attr$viewId);return v.isEmptyString(t,!0)&&(t=e.id),t}function m(){var e=document.querySelector("["+V.attr$view_container+"]");return null==e&&(e=document.body),e}function i(t){1<arguments.length&&(t=String(t).trim().toLowerCase());var e=[];for(var n in r)e=e.concat(r[n]);return arguments.length<1||v.isEmptyString(t,!0)?e:e.filter(function(e){return t===e.getName()})}function a(e){var l=(e=v.setDftValue(e,{srcView:null,targetView:null,type:View.SWITCHTYPE_VIEWNAV,trigger:View.SWITCHTRIGGER_APP,withAnimation:!0,params:null,options:null,onbeforeswitch:null})).srcView,u=e.targetView,c=function(e){v.isEmptyString(e,!0)&&(e=View.SWITCHTYPE_VIEWNAV);var t=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWNAV),n=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWCHANGE),i=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYBACK),r=v.ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYFORWARD);return i||r||t||n||(e=View.SWITCHTYPE_VIEWNAV),e}(e.type),f=function(e){v.isEmptyString(e,!0)&&(e=View.SWITCHTRIGGER_APP);var t=v.ifStringEqualsIgnoreCase(e,View.SWITCHTRIGGER_APP),n=v.ifStringEqualsIgnoreCase(e,View.SWITCHTRIGGER_NAVIGATOR);return t||n||(e=View.SWITCHTRIGGER_APP),e}(e.trigger),g=e.params,d=e.options,h=v.ifStringEqualsIgnoreCase(c,View.SWITCHTYPE_HISTORYBACK),w=v.ifStringEqualsIgnoreCase(c,View.SWITCHTYPE_HISTORYFORWARD),p={get currentView(){return o.warn("Field 'currentView' is deprecated, please use 'sourceView' instead"),l},sourceView:l,targetView:u,type:c,trigger:f,params:g,options:d};Object.freeze&&Object.freeze(p);for(var t=View.getSwitchInterceptors(),n=0;n<t.length;n++){var i=t[n];try{if(!i(p))return o.info("Supplied switch interceptor(name: {}) blocked the view switch",i.name),void console.log(i)}catch(e){return console.error("Error occurred while executing supplied interceptor",i),void console.error(e)}}function r(){var e=u.id,t=u.namespace;b.clearViewParameters(e,t);var n,i=b.keyForParamsAutoSavedToContext,r=u.getIfAutoSaveParamsToContext();function a(e,t){u.fire(e,o,t)}h?b.hasParameters(S.PSVIEW_BACK,"")&&(n=b.getParameters(S.PSVIEW_BACK,""),b.setViewParameters(e,t,n),b.clearViewParameters(S.PSVIEW_BACK,""),r?null!=n&&"object"==typeof n&&u.context.set(i,n):u.context.remove(i)):w?b.hasParameters(S.PSVIEW_FORWARD,"")&&(n=b.getParameters(S.PSVIEW_FORWARD,""),b.setViewParameters(e,t,b.getParameters(S.PSVIEW_FORWARD,"")),b.clearViewParameters(S.PSVIEW_FORWARD,""),r?null!=n&&"object"==typeof n&&u.context.set(i,n):u.context.remove(i)):(b.setViewParameters(e,t,g),r?null!=g&&"object"==typeof g&&u.context.set(i,g):u.context.remove(i));var o={sourceView:l,type:c,trigger:f,params:g,options:d};l&&v.removeClass(l.getDomElement(),"active"),l&&l.fire("leave",{targetView:u,type:c,trigger:f,params:g,options:d}),E.push(u),a("beforeenter",!1),v.addClass(u.getDomElement(),"active"),v.blurInputs(),y.ofId(e,t).doLayout(),View.fire("change",p,!1),u.isReady()||(A.push(u),a("ready",!1)),a("enter",!1),a("afterenter",!1);var s=m();s.setAttribute(V.attr$active_view_id,e),s.setAttribute(V.attr$active_view_namespace,t),I=null,View.fire("afterchange",p)}v.try2Call(e.onbeforeswitch),View.fire("beforechange",p,!1),e.withAnimation&&s?s.call(null,{srcElement:l?l.getDomElement():null,targetElement:u.getDomElement(),type:c,trigger:f,render:r}):r()}var o=e.get("Logger").globalLogger,v=e.get("util"),y=e.get("ViewLayout"),b=e.get("viewParameter"),S=e.get("viewRepresentation"),V=e.get("viewAttribute"),r={},E=[],A=[],s=null,c="default",I=null;e.set("viewInternalVariable",{defaultNamespace:c,defaultWidthHeightRatio:"320/568",get intendedSwitchType(){return I},set intendedSwitchType(e){I=e},viewInstancesMap:r,readyViews:A,viewVisitStack:E,get viewSwitchAnimation(){return s},set viewSwitchAnimation(e){s=e},getPotentialViewId:u,getViewContainerDomElement:m,getViewDomElements:function(){for(var e=m(),t=[],n=document.querySelectorAll("*["+V.attr$view+"=true]"),i=0;i<n.length;i++)!function(e){if(!(e instanceof HTMLElement))return!1;var t=e.getAttribute(V.attr$view);return null!=t&&("true"===(t=t.toLowerCase())&&!v.isEmptyString(u(e),!0))}(n[i])||t.push(n[i]);for(n=e.querySelectorAll("["+V.attr$viewId+"]"),i=0;i<n.length;i++){var r=u(n[i]);v.isEmptyString(r,!0)||-1===t.indexOf(n[i])&&(n[i].setAttribute(V.attr$view,"true"),t.push(n[i]))}return t},getViewDomElementOfId:function(e,t){(arguments.length<2||v.isEmptyString(t,!0))&&(t=c),l(t);var n=document.querySelectorAll("["+V.attr$view+"=true]");if(0===n.length)return null;for(var i=null,r=0;r<n.length;r++){var a=n[r],o=u(a),s=a.getAttribute(V.attr$view_namespace);if(v.isEmptyString(s,!0)&&(s=c),e===o&&s===t){i=a;break}}return i},buildNamespace:l,getFinalView:function(e,t){(arguments.length<2||"string"!=typeof t||v.isEmptyString(t,!0))&&(t=c),l(t);var n=null;return v.isEmptyString(e,!0)||!View.ifExists(e,t)?n=View.getActiveView()||View.getDefaultView():(n=View.ofId(e,t)).isDirectlyAccessible()||(n=n.getFallbackView()),n},listAllViews:i,findFirstViewOfName:function(e){if(v.isEmptyString(e,!0))return o.error("Empty view name!"),null;e=String(e).trim().toLowerCase();var t=i(e);if(null==t||0===t.length)return o.error("No view of name: {} found",e),null;var n=t[0];return o.info("Found {} views of name: {}, using the first one: {}@{}",t.length,e,n.id,n.namespace),n},switchView:a,showView:function(e,t,n){if((arguments.length<2||"string"!=typeof t||v.isEmptyString(t,!0))&&(t=c),l(t),n=n||{},!View.ifExists(e,t))throw o.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options),new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist!");var i=View.getActiveView();o.log("{}@{} → {}@{} {}",i?i.getId():null,i?i.getNamespace():null,e,t,JSON.stringify(n));var r=View.ofId(e,t);return n.srcView=i,n.targetView=r,a(n),View}})}),View(function(e){var h=e.get("util"),w=e.get("eventDrive"),p=(e.get("ViewState"),e.get("Logger")),m=e.get("ViewConfigurationSet"),v=e.get("ViewContext"),y=e.get("ViewLayout"),b=e.get("viewRepresentation"),S=e.get("viewParameter"),V=e.get("viewAttribute"),E=e.get("viewInternalVariable"),A=p.globalLogger,I=function(r,a){(arguments.length<2||h.isEmptyString(a,!0))&&(a=E.defaultNamespace);for(var o=null,s=document.querySelectorAll("["+V.attr$view+"=true]"),e=[],t=0;t<s.length;t++)e.push(s[t]);s=document.querySelectorAll("["+V.attr$viewId+"]:not(["+V.attr$view+"=true])");for(t=0;t<s.length;t++)e.push(s[t]);if(0===(s=e).length||function(){for(var e=0;e<s.length;e++){var t=s[e],n=E.getPotentialViewId(t),i=t.getAttribute(V.attr$view_namespace);if(h.isEmptyString(i,!0)&&(i=E.defaultNamespace),r===n&&i===a){o=t;break}}return null==o}())throw new Error("View of id: '"+r+"' within namespace: '"+a+"' does not exist!");var i={},l=new v,n=new m(r,a),u=!0,c=null,f=[];w(this,o);var g=this.fire;this.fire=function(e,t,n){i[e]=t,g(e,t,n)};var d=this;h.defineReadOnlyProperty(this,"id",r),h.defineReadOnlyProperty(this,"namespace",a),h.defineReadOnlyProperty(this,"logger",p.ofName("View#"+r)),h.defineReadOnlyProperty(this,"config",n),h.defineReadOnlyProperty(this,"context",l),this.getLatestEventData=function(e){return i[e]},this.getContext=function(){return l},this.clearContext=function(){return l.clear(),this},this.getId=function(){return r},this.getNamespace=function(){return a},this.getDomElement=function(){return o},this.getName=function(){var e=o.getAttribute(V.attr$view_name);return null!=e?e=e.trim().toLowerCase():null==(e=o.getAttribute(V.attr$view_group))?null:(A.warn("Attribute 'data-view-group' is deprecated, please use 'data-view-name' instead"),e=e.trim().toLowerCase())},this.getGroupName=function(){A.warn("This method is deprecated, please use 'this.getName()' instead");var e=o.getAttribute(V.attr$view_group);return null==e?e:(A.warn("Attribute 'data-view-group' is deprecated, please use 'data-view-name' instead"),e=e.trim().toLowerCase())},this.find=function(e){return o.querySelector(e)},this.findAll=function(e){return o.querySelectorAll(e)},this.setLayoutAction=function(e,t){return arguments.length<2&&(t=!0),y.ofId(r,a).setIfLayoutWhenLayoutChanges(!!t).setLayoutAction(e),this},this.getLayoutAction=function(){return y.ofId(r,a).getLayoutAction()},this.hasParameter=function(e){if(null==e)return!1;var t=S.getParameters(this.id,this.namespace);return null!=t&&e in t},this.getParameter=function(e){var t=S.getParameters(this.id,this.namespace);return arguments.length<1?t||null:null==t?null:t[e]},this.seekParameter=function(e,t){if(this.hasParameter(e))return this.getParameter(e);if(I.hasActiveViewOption(e))return I.getActiveViewOption(e);var n=new RegExp("\\b"+e+"\\b=([^&\\?]*)"),i=location.search.match(n);if(null!=i)return decodeURIComponent(i[1]);if(arguments.length<2&&(t=!0),!t||!u)return null;var r=S.keyForParamsAutoSavedToContext,a=null;return l.has(r)&&null!=(a=l.get(r))&&"object"==typeof a&&e in a?a[e]:null},this.setIfAutoSaveParamsToContext=function(e){return arguments.length<1&&(e=!0),u=!!e,this},this.getIfAutoSaveParamsToContext=function(){return u},this.isReady=function(){return-1!==E.readyViews.indexOf(this)},this.isActive=function(){return h.hasClass(o,"active")},this.getActiveTimes=function(){return E.viewVisitStack.reduce(function(e,t){return t===d&&e++,e},0)},this.isDefault=function(){return/true/i.test(o.getAttribute(V.attr$view_default))},this.isDirectlyAccessible=function(){var e=null==(e=o.getAttribute(V.attr$view_directly_accessible))?null:e.toLowerCase();return I.isDirectlyAccessible()?"false"!==e:"true"===e},this.setAsDirectlyAccessible=function(e){return arguments.length<1&&(e=!0),o.setAttribute(V.attr$view_directly_accessible,String(e)),this},this.setTitle=function(e){return null==e?o.removeAttribute(V.attr$view_title):(e=String(e),o.setAttribute(V.attr$view_title,e),this.isActive()&&(document.title=e)),this},this.getTitle=function(){return o.getAttribute(V.attr$view_title)},this.setFallbackViewId=function(e,t){if(h.isEmptyString(e,!0))return this;if((arguments.length<2||h.isEmptyString(t,!0))&&(t=E.defaultNamespace),E.buildNamespace(t),h.ifStringEqualsIgnoreCase(b.PSVIEW_DEFAULT,e)){var n=I.getDefaultView();if(null==n)return A.error("No default view found to set as fallback view"),this;e=n.id,t=n.namespace}else if(/^~/.test(e)){var i=e.substring(1),r=E.findFirstViewOfName(i);if(null==r)return A.warn("No view of name: {} found to set as fallback view",i),this;e=r.id,t=r.namespace}return I.ifExists(e,t)?this.id===e&&this.namespace===t||(o.setAttribute(V.attr$view_fallback,e),o.setAttribute(V.attr$view_fallback_namespace,t)):A.warn("No view of id: {} in namespace: {} found to set as fallback view",e,t),this},this.getFallbackView=function(){for(var e=this,t=[{id:this.id,namespace:this.namespace}];;){var n=e.getDomElement(),i=n.getAttribute(V.attr$view_fallback);if(null==i||""===(i=i.trim()))return I.getDefaultView();if(h.ifStringEqualsIgnoreCase(b.PSVIEW_DEFAULT,i))return I.getDefaultView();var r=n.getAttribute(V.attr$view_fallback_namespace)||E.defaultNamespace;if(/^~/.test(i)){var a=i.substring(1),o=E.findFirstViewOfName(a);if(null==o)return A.warn("No view of name: {} found to render as fallback view for view: {} in namespace: {}",this.id,this.namespace),I.getDefaultView();i=o.id,r=o.namespace}if(!I.ifExists(i,r))return A.debug("Configured fallback view of id: {}, namespace: {} doest not exist for view: {} in namespace: {}",i,r,this.getId(),this.getNamespace()),I.getDefaultView();if(e=I.ofId(i,r),t.some(function(e){return e.id===i&&e.namespace===r}))return A.error("Cyclical reference on fallback view configuration. Chain: {}",t),I.getDefaultView();if(e.isDirectlyAccessible())return e;t.push({id:i,namespace:r})}},this.setDataFetchAction=function(e){return"function"==typeof e?c=e:A.warn("Invalid argument. Type of 'Function' is required"),this},this.getDataFetchAction=function(){return c},this.fetchData=function(){var e=h.isPromiseSupported()&&!1;return"function"!=typeof c?e?Promise.resolve(void 0):{then:function(e,t){h.try2Call(e,null,void 0)}}:e?Promise(function(e,t){h.try2Call(c,null,e,t)}):{then:function(t,n){h.try2Call(c,null,function(e){h.try2Call(t,null,e)},function(e){h.try2Call(n,null,e)})}}},this.addTimer=function(e,t,n){if("function"==typeof e&&(n=t,t=e,e=h.randomString("timer")),h.isEmptyString(e,!0))throw new Error("Invalid argument. Timer name should not be empty");for(var i=String(e).trim().toLowerCase(),r=0;r<f.length;r++)if(f[r].name===i)throw new Error("Timer of name: '"+e+"' exists already");if("function"!=typeof t)throw new Error("Invalid argument. Timer handle should be of type: 'Function'");var a=Math.round(Number(n));if(isNaN(a)||a<1)throw new Error("Invalid arguemnt. Timer interval should be of type: 'Number' and be greater than 0");var o={name:i,handle:t,interval:n,timer:null};return f.push(o),this.isActive()&&(h.try2Call(t),o.timer=setInterval(function(){h.try2Call(t)},n)),this},this.startTimer=function(e){if(h.isEmptyString(e,!0))return!1;e=String(e).trim().toLowerCase();for(var t=0;t<f.length;t++){var n=f[t];if(n.name===e)return null===n.timer&&(h.try2Call(n.handle),n.timer=setInterval(function(e){return function(){h.try2Call(e)}}(n.handle),n.interval),!0)}return!1},this.startAllTimers=function(){for(var e=0;e<f.length;e++){var t=f[e];null===t.timer&&(h.try2Call(t.handle),t.timer=setInterval(function(e){return function(){h.try2Call(e)}}(t.handle),t.interval),t.timer=null)}return this},this.stopTimer=function(e){if(h.isEmptyString(e,!0))return!1;e=String(e).trim().toLowerCase();for(var t=0;t<f.length;t++){var n=f[t];if(n.name===e)return null!==n.timer&&(clearInterval(n.timer),!(n.timer=null))}return!1},this.stopAllTimers=function(){for(var e=0;e<f.length;e++){var t=f[e];clearInterval(t.timer),t.timer=null}return this},this.on("enter",function(){for(var e=0;e<f.length;e++){var t=f[e];h.try2Call(t.handle),t.timer=setInterval(function(e){return function(){h.try2Call(e)}}(t.handle),t.interval)}}),this.on("leave",function(){for(var e=0;e<f.length;e++){var t=f[e];clearInterval(t.timer),t.timer=null}})};e.set("ViewConstructor",I)}),View(function(e){var r,a,h=e.get("util"),t=e.get("eventDrive"),n=e.get("Logger"),w=e.get("touch"),p=e.get("layout"),m=e.get("ViewConstructor"),i=e.get("ViewContext"),v=e.get("ViewState"),o=e.get("OperationState"),s=(e.get("ViewLayout"),e.get("ChainedHandle")),y=e.get("viewRepresentation"),l=e.get("viewParameter"),b=e.get("viewAttribute"),S=e.get("viewInternalVariable"),V=n.globalLogger,u=null,c=[],E=document.title,A=!1,I=[],C=!1,P=[];t(m),m.SWITCHTYPE_HISTORYFORWARD="history.forward",m.SWITCHTYPE_HISTORYBACK="history.back",m.SWITCHTYPE_VIEWNAV="view.nav",m.SWITCHTYPE_VIEWCHANGE="view.change",m.SWITCHTRIGGER_APP="app",m.SWITCHTRIGGER_NAVIGATOR="navigator",m.currentState=null,m.Logger=n,m.layout=p,m.context=new i,m.checkIfBrowserHistorySupportsPushPopAction=function(){return h.env.isHistoryPushPopSupported},m.getViewContainerDomElement=S.getViewContainerDomElement,m.addSwitchInterceptor=function(e){if("function"!=typeof e)throw new Error("Invalid argument, type of 'Function' is required");return-1===c.indexOf(e)&&c.push(e),m},m.getSwitchInterceptors=function(){return c.concat()},m.find=function(e,t){return 1===arguments.length&&(t=e,e=m.getViewContainerDomElement()),null==e?null:e.querySelector(t)},m.findAll=function(e,t){return 1===arguments.length&&(t=e,e=m.getViewContainerDomElement()),null==e?null:e.querySelectorAll(t)},m.ofId=function(e,t){(arguments.length<2||h.isEmptyString(t,!0))&&(t=S.defaultNamespace),S.buildNamespace(t);for(var n=S.viewInstancesMap[t],i=0;i<n.length;i++)if(n[i].getId().trim()===e.trim()&&n[i].getNamespace().trim()===t.trim())return n[i];var r=new m(e,t);return n.push(r),r},m.ifExists=function(e,t){(arguments.length<2||h.isEmptyString(t,!0))&&(t=S.defaultNamespace),S.buildNamespace(t);for(var n=S.viewInstancesMap[t],i=0;i<n.length;i++)if(n[i].getId().trim()===e.trim())return!0;return!1},m.listAll=S.listAllViews,m.listAllViewNames=function(){return S.listAllViews().reduce(function(e,t){var n=t.getName();return h.isEmptyString(n,!0)||-1!==e.indexOf(n)||e.push(n.toLowerCase().trim()),e},[])},m.listAllGroups=function(){return V.warn("This method is deprecated, please use 'View.listAllViewNames()' instead"),m.listAllViewNames()},m.setAsDefault=function(e,t){if((arguments.length<2||h.isEmptyString(t,!0))&&(t=S.defaultNamespace),S.buildNamespace(t),h.isEmptyString(e,!0))return V.warn("No view id supplied to set as default"),m;for(var n=S.getViewDomElements(),i=0;i<n.length;i++)n[i].removeAttribute(b.attr$view_default);var r=S.getViewDomElementOfId(e,t);return null==r?V.error("No dom element for view of id: '{}' namespace: '{}' found to set as default",e,t):r.setAttribute(b.attr$view_default,"true"),m},m.isDirectlyAccessible=function(){var e,t=b.attr$view_directly_accessible,n=m.getViewContainerDomElement().getAttribute(t),i=document.documentElement.getAttribute(t);if(null===n){if(null===i)return!1;e=i,V.warn("Declaring view attribute: '{}' in <html> element is deprecated, you should declare in the view container's dom element",t)}else null===i?e=n:(e=n,V.warn("Found view attribute: '{}' in the view container's dom element, ingoring the one declared in <html> element",t));return h.ifStringEqualsIgnoreCase("true",e)},m.setIsDirectlyAccessible=function(e){return m.getViewContainerDomElement().setAttribute(b.attr$view_directly_accessible,String(!!e).toLowerCase()),m},m.setViewIsDirectlyAccessible=function(e,t,n){if(arguments.length<2)throw new Error("Illegal argument length. Call with arguments: 'viewId[, viewNamespace], accessible'");arguments.length<3&&(n=t,t=S.defaultNamespace);var i=S.getViewDomElementOfId(e,t);return null==i?V.error("No view of id: {}, namespace: {} found to set is directly accessible or not",e,t):i.setAttribute(b.attr$view_directly_accessible,String(!!n).toLowerCase()),m},m.getActiveView=function(){for(var e=S.listAllViews(),t=0;t<e.length;t++)if(e[t].isActive())return e[t];return null},m.getDefaultView=function(){for(var e=S.listAllViews(),t=0;t<e.length;t++)if(e[t].isDefault())return e[t];return null},m.setSwitchAnimation=function(e){if(!(e instanceof Function))throw new Error("Invalid argument, type of 'Function' is required");return S.viewSwitchAnimation=e,m},m.getSwitchAnimation=function(){return S.viewSwitchAnimation},m.getActiveViewOptions=function(){var e=y.parseViewInfoFromHash(location.hash);return null==e?null:e.options},m.hasActiveViewOption=function(e){var t=m.getActiveViewOptions();return null!=t&&e in t},m.getActiveViewOption=function(e){var t=m.getActiveViewOptions();return null==t?null:t[e]},m.setActiveViewOption=function(e,t){if(h.isEmptyString(e,!0))return V.error("Option name should not be empty"),m;var n=m.getActiveView();if(null==n)return V.error("No view is active to set option {} = {}",e,t),m;e=String(e).trim(),t=String(t).trim();var i=m.getActiveViewOptions()||{};return i[e]=t,v.replaceViewState(n.id,n.namespace,m.currentState?m.currentState.sn:null,i),m};function f(e,t,n){if(arguments.length<3&&(n="nav"),(arguments.length<2||"string"!=typeof t||h.isEmptyString(t,!0))&&(t=S.defaultNamespace),S.buildNamespace(t),h.ifStringEqualsIgnoreCase(y.PSVIEW_DEFAULT,e)){var i=m.getDefaultView();if(null==i)return V.error("No default view found"),m;e=i.id,t=i.namespace}if(/^~/.test(e)){var r=e.substring(1),a=S.findFirstViewOfName(r);if(null==a)return m;e=a.id,t=a.namespace}return m.ifExists(e,t)?v["nav"===n?"pushViewState":"replaceViewState"](e,t):console.error(new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist!")),m}m.navBy=function(e,t,n){return f(e,t,"nav"),m},m.passBy=function(e,t,n){return V.warn("This method is deprecated, and it will be removed someday in the future, please use 'View.navBy()' instead"),f(e,t,"nav"),m},m.changeBy=function(e,t,n){return f(e,t,"change"),m},m.getChainedHandleByName=function(e){return V.warn("This method is deprecated, and it will be removed someday in the future"),s.ofName(e)},m.navTo=function(e,t,n){e instanceof m?(n=t,t=e.namespace,e=e.id):(arguments.length<2||"string"!=typeof t||h.isEmptyString(t,!0))&&(n=t,t=S.defaultNamespace),S.buildNamespace(t),e=e.trim(),n=h.setDftValue(n,{});m.getActiveView();if(h.ifStringEqualsIgnoreCase(y.PSVIEW_BACK,e))return m.back(n),m;if(h.ifStringEqualsIgnoreCase(y.PSVIEW_FORWARD,e))return m.forward(n),m;if(h.ifStringEqualsIgnoreCase(y.PSVIEW_DEFAULT,e)){var i=m.getDefaultView();if(null==i)return V.error("No default view found"),m;e=i.id,t=i.namespace}if(/^\s*~/.test(e)){var r=e.replace(/^\s*~+/,"").trim(),a=S.findFirstViewOfName(r);if(null==a)return m;e=a.id,t=a.namespace}if(/^(http|https|ftp):\/\//gim.test(e))return window.location.assign(e),m;if(/^\s*@+/.test(e)){var o=e.replace(/^\s*@+/,"").trim();return""===o?void V.warn("Empty target: '{}'",e):(window.location.assign(o),m)}if(m.ifExists(e,t))return n.type=m.SWITCHTYPE_VIEWNAV,n.trigger=m.SWITCHTRIGGER_APP,n.onbeforeswitch=function(){v.pushViewState(e,t,null,null==n?null:n.options)},S.intendedSwitchType=m.SWITCHTYPE_VIEWNAV,S.showView(e,t,n),m;V.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options);var s=new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist! Firing event 'viewnotexist'...");return console.error(s),m.fire("viewnotexist",{targetViewId:e,targetViewNamespace:t}),m},m.changeTo=function(e,t,n){e instanceof m?(n=t,t=e.namespace,e=e.id):(arguments.length<2||"string"!=typeof t||h.isEmptyString(t,!0))&&(n=t,t=S.defaultNamespace),S.buildNamespace(t),n=h.setDftValue(n,{});m.getActiveView();if(h.ifStringEqualsIgnoreCase(y.PSVIEW_DEFAULT,e)){var i=m.getDefaultView();if(null==i)return void V.error("No default view found");e=i.id,t=i.namespace}if(/^\s*~/.test(e)){var r=e.replace(/^\s*~+/,"").trim(),a=S.findFirstViewOfName(r);if(null==a)return m;e=a.id,t=a.namespace}if(/^(http|https|ftp):\/\//gim.test(e))return window.location.replace(e),m;if(/^\s*@+/.test(e)){var o=e.replace(/^\s*@+/,"").trim();return""===o?void V.warn("Empty target: '{}'",e):(window.location.replace(o),m)}if(m.ifExists(e,t))return n.type=m.SWITCHTYPE_VIEWCHANGE,n.trigger=m.SWITCHTRIGGER_APP,n.onbeforeswitch=function(){v.replaceViewState(e,t,null,null==n?null:n.options)},S.intendedSwitchType=m.SWITCHTYPE_VIEWCHANGE,S.showView(e,t,n),m;V.log("Trying to navigate to view: '{}' within namespace: '{}' with params: {}, options: {}",e,t,n.params,n.options);var s=new Error("Target view: '"+e+"' within namespace: '"+t+"' does not exist! Firing event 'viewnotexist'...");return console.error(s),m.fire("viewnotexist",{targetViewId:e,targetViewNamespace:t}),m},m.setNoViewToNavBackAction=function(e){if("function"!=typeof e)throw new Error("Invalid argument! Type of 'Function' is required");return u=e,m},m.back=function(e){return S.intendedSwitchType=m.SWITCHTYPE_HISTORYBACK,l.clearViewParameters(y.PSVIEW_BACK,""),null!=e&&"params"in e&&l.setViewParameters(y.PSVIEW_BACK,"",e.params),m.ifCanGoBack()||"function"!=typeof u?history.go(-1):h.try2Call(u),m},m.forward=function(e){return S.intendedSwitchType=m.SWITCHTYPE_HISTORYFORWARD,l.clearViewParameters(y.PSVIEW_FORWARD,""),null!=e&&"params"in e&&l.setViewParameters(y.PSVIEW_FORWARD,"",e.params),history.go(1),m},m.setDocumentTitle=function(e){if(h.isEmptyString(e,!0))return V.warn("Invalid document title: "+e),m;E=e;var t=m.getActiveView();return null!=t&&!h.isEmptyString(t.getTitle(),!0)||(document.title=E),m},m.onceHistoryBack=function(e){if(V.warn("This method is deprecated, and it will be removed someday in the future"),"function"!=typeof e)throw new Error("Invalid argument! Type of 'Function' is required");return o.pushState(h.randomString(),e),m},m.reDoLayout=function(){return S.listAllViews().forEach(function(e){h.try2Call(e.getLayoutAction())}),m},m.ifCanGoBack=v.ifCanGoBack,m.beforeInit=function(e){return"function"!=typeof e?V.warn("Type of 'Function' is required"):A?V.error("View.js is initialized already"):-1===I.indexOf(e)&&I.push(e),m},m.ready=function(e){return"function"!=typeof e?V.warn("Type of 'Function' is required"):C?h.try2Call(e):-1===P.indexOf(e)&&P.push(e),m},m.setInitializer=function(e,t){if("function"!=typeof e)return m;V.warn("This method is deprecated, please use 'data-view-auto-init' attribute and 'View.init()' method instead");var n="domready";arguments.length<2&&(t=n);var i="domready, rightnow".split(/\s*,\s*/);return-1===i.indexOf(t)&&(V.warn("Unknown initializer exec time: {}. Supported: {}",t,i),t=n),r=e,a=t,A||"rightnow"!==t||(V.info("Calling specified view initializer right now"),r(g)),m};function T(e){var t=m.getActiveView(),n=null,i=null;null!=t&&(n=t.getId(),i=t.getNamespace()),V.log("{} Current: {}",h.env.isHistoryPushPopSupported?"State popped!":"Hash changed!",t&&t.getId()),V.log("↑ {}",h.env.isHistoryPushPopSupported?JSON.stringify(e.state):location.hash);var r,a,o,s=null,l=null,u=null,c=null,f=null,g=m.SWITCHTYPE_VIEWNAV,d=null;null==e.state?(g=m.SWITCHTYPE_VIEWNAV,null==(r=y.parseViewInfoFromHash(location.hash))?(u=n,c=i,f=t):(s=r.viewId,l=r.viewNamespace,u=s,c=l,m.ifExists(u,c)&&(f=m.ofId(u,c))),null!=u&&null!=f&&(a=u===s&&c===l,d=u===n&&c===i?m.currentState?m.currentState.options:null:a?r.options:null,S.showView(u,c,{type:g,trigger:m.SWITCHTRIGGER_APP,options:d,onbeforeswitch:function(){v.replaceViewState(u,c,null,d)}}))):v.isConstructorOf(e.state)?(s=(o=e.state).viewId,l=o.viewNamespace,d=m.ifExists(s,l)?(f=m.ofId(s,l),o.options):(V.warn("Popped view: '"+s+"' within namespace: '"+l+"' does not exist, keeping current"),f=t,null),u=f.getId(),c=f.getNamespace(),null!=m.currentState&&(g=o.sn<m.currentState.sn?m.SWITCHTYPE_HISTORYBACK:m.SWITCHTYPE_HISTORYFORWARD),S.showView(u,c,{type:g,trigger:null!=S.intendedSwitchType?m.SWITCHTRIGGER_APP:m.SWITCHTRIGGER_NAVIGATOR,options:d,onbeforeswitch:function(){v.replaceViewState(u,c,o.sn,d)}})):V.info("Skip state: {}",e.state)}var g=function(){var i,r,e,t,n,a,o,s,l,u,c,f,g,d;A?V.error("View.js was initialized already"):(function(){for(var e=0;e<I.length;e++)h.try2Call(I[e]);I=[]}(),E=document.title,document.documentElement.setAttribute(b.attr$view_os,h.env.isIOS?"ios":h.env.isAndroid?"android":h.env.isWindowsPhone?"wp":"unknown"),window.addEventListener(h.env.isHistoryPushPopSupported?"popstate":"hashchange",T),function(){var e=document.querySelectorAll("["+b.attr$view_container+"]");if(0===e.length)document.body.setAttribute(b.attr$view_container,"");else for(var t=1;t<e.length;t++)e[t].removeAttribute(b.attr$view_container)}(),m.getViewContainerDomElement().setAttribute(b.attr$view_state,"initing"),i=S.getViewDomElements(),r=[],[].forEach.call(i,function(t){var e=t.getAttribute(b.attr$view_namespace);h.isEmptyString(e,!0)&&(e=S.defaultNamespace,t.setAttribute(b.attr$view_namespace,e));var n=S.getPotentialViewId(t),i=m.ofId(n,e);-1===r.indexOf(i)?(r.push(i),h.removeClass(t,"active"),h.addClass(t,"view"),i.on("enter",function(){var e=t.getAttribute(b.attr$view_title);document.title=null==e?E:e})):V.warn("Multiple view of id: '{}' within namespace: '{}' exists",i.id,i.namespace)}),(d=null)!=(d=function(){for(var e=null,t=-1,n=0;n<i.length;n++)if("true"===i[n].getAttribute(b.attr$view_default)){t=n;break}if(-1!==t){e=i[t];for(n=t+1;n<i.length;n++)"true"===i[n].getAttribute(b.attr$view_default)&&i[n].removeAttribute(b.attr$view_default)}else 0!==i.length?(e=i[0]).setAttribute(b.attr$view_default,"true"):V.warn("No view exists to serve as default view");return e}())&&h.addClass(d,"active"),w.addTapListener(document.documentElement,function(e){for(var t,n,i=e.changedTouches?e.changedTouches[0].target:e.target,r=S.defaultNamespace,a=i;null==a.getAttribute(b.attr$view_rel)&&((a=a.parentNode)instanceof HTMLElement||(a=null),null!=a););if((null!=a&&(t=a.getAttribute(b.attr$view_rel),r=a.getAttribute(b.attr$view_rel_namespace)),h.isEmptyString(r,!0)&&(r=S.defaultNamespace),null!=t&&""!==t.trim())&&!("true"===a.getAttribute(b.attr$view_rel_disabled)))if(e.preventDefault(),/^(http|https|ftp):\/\//gim.test(t))window.location.href=t;else{if(/^\s*@+/.test(t)){var o=t.replace(/^\s*@+/,"").trim();return""===o?void V.warn("Empty file path for data-view-rel: '{}'",t):void(window.location.href=o)}if(h.ifStringEqualsIgnoreCase(y.PSVIEW_BACK,t))m.back();else if(h.ifStringEqualsIgnoreCase(y.PSVIEW_FORWARD,t))m.forward();else{!h.ifStringEqualsIgnoreCase(y.PSVIEW_DEFAULT,t)||null!=(n=m.getDefaultView())&&(t=n.id,r=n.namespace);var s=null;if(/^~/.test(t)){var l=t.match(/^~([^!]+)(?:!+(.*))?/);if(null==l)return;var u=l[1].trim(),c=h.parseParams(l[2]),f=S.findFirstViewOfName(u);if(null==f)return;t=f.id,r=f.namespace,s=c}else{var g=y.parseViewInfoFromHash("#"+t);h.isEmptyString(g.specifiedViewNamespace,!0)||(r=g.specifiedViewNamespace),t=g.viewId,s=g.options}var d=a.getAttribute(b.attr$view_rel_type),d=h.isEmptyString(d,!0)?"nav":d;/^(?:nav)|(?:change)$/.test(d)||(V.warn("Unknown view switch type: {}. {}",d,a),d="nav"),m[d+"To"](t,r,{options:s})}}},{useCapture:!0}),function(){h.blurInputs();var e,t,n=m.getViewContainerDomElement().getAttribute(b.attr$view_whr);null!=n&&""!==(n=n.trim().toLowerCase())||null!=(n=document.documentElement.getAttribute(b.attr$view_whr))&&""!==(n=n.trim().toLowerCase())&&V.warn("Declaring view attribute: '{}' in <html> element is deprecated, you should declare in the view container's dom element",b.attr$view_whr),null!=n&&""!==(n=n.trim().toLowerCase())?"unlimited"!==n&&(e=/(\d+(?:\.\d*)?)\s*\/\s*(\d+(?:\.\d*)?)/i,null==(t=n.match(e))?(V.warn("Invalid view expected width height ratio: {}. Value such as '320/568'(iPhone 5) is valid. Using '{}' instead",n,S.defaultWidthHeightRatio),t=S.defaultWidthHeightRatio.exec(e)):V.info("Using specified expected width height ratio: {}",n),p.setExpectedWidthHeightRatio(Number(t[1])/Number(t[2])).init(),p.doLayout(!1)):p.init().doLayout(!1)}(),V.info("Marking View as initialized and ready"),A=!0,function(){C=!0;for(var e=0;e<P.length;e++)h.try2Call(P[e]);P=[],m.getViewContainerDomElement().setAttribute(b.attr$view_state,"ready")}(),null==m.currentState?(e=null==d?null:S.getPotentialViewId(d),t=null==d?null:d.getAttribute(b.attr$view_namespace)||S.defaultNamespace,a=null==(n=y.parseViewInfoFromHash(location.hash))?null:n.viewId,o=null==n?null:n.viewNamespace,s=null==n?null:n.options,f=c=null,l=h.isEmptyString(e,!0),h.isEmptyString(a,!0)?l?f=c=null:m.ifExists(e,t)?(c=e,f=t):V.warn("No default view of id: '{}' within namespace: '{}' found",e,t):m.ifExists(a,o)?(c=a,f=o):V.warn("No view of id: '{}' namespace: '{}'(specified in the location hash) found, trying to show the default view",a,o),h.isEmptyString(c,!0)||(null!=(u=S.getFinalView(c,f))?(c=u.getId(),f=u.getNamespace(),c===a&&f===o||(s=null),V.info("Showing view: '{}' within namespace: '{}'",c,f),g=m.getActiveView(),S.switchView({srcView:g===u?null:g,targetView:u,withAnimation:!1,params:null,onbeforeswitch:function(){v.replaceViewState(c,f,null,s)}})):V.error("No final view found for view of id: '{}', namespace: '{}'",c,f))):V.debug("Skip showing specified view"))};m.init=function(){return g(),m},document.addEventListener("DOMContentLoaded",function(){var e;null==r?null!==(e=m.getViewContainerDomElement().getAttribute(b.attr$view_auto_init))&&"false"===e.trim().toLowerCase()||(V.info("Initializing View.js automatically"),g()):"domready"===a&&(V.info("Calling specified View.js initializer"),r(g))}),e.expose(m)});